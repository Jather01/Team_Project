<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop">
<insert id="insert" parameterType="shopDto">
	INSERT INTO songpring_shop
	(num, title, imagePath, genre, writer, publisher, regdate, price, content, sellCount, page, bookSize)
	VALUES(songpring_shop_seq.NEXTVAL, #{title}, #{imagePath}, #{genre}, #{writer},
		#{publisher}, #{regdate}, #{price}, #{content}, 0, #{page}, #{bookSize})
</insert>
<update id="update" parameterType="shopDto">
	UPDATE board_cafe
	SET title=#{title}, imagePath=#{imagePath}, genre=#{genre}, writer=#{writer}, publisher=#{publisher},
		regdate=#{regdate}, price=#{price}, content=#{content}, page=#{page}, bookSize=#{bookSize}
	WHERE num=#{num}
</update>
<delete id="delete" parameterType="int">
	DELETE FROM songpring_shop
	WHERE num=#{num}
</delete>
<select id="getData" parameterType="int" resultType="shopDto">
	SELECT num, title, imagePath, genre, writer, publisher, TO_CHAR(regdate , 'YYYY-MM-DD') as regdate, price, content, sellCount, page, bookSize
	FROM songpring_shop
	WHERE num=#{num}
</select>
<select id="getList" parameterType="shopDto" resultType="shopDto">
	SELECT *
	FROM
		(SELECT result1.*, ROWNUM AS rnum
		FROM
			(SELECT num, title, imagePath, genre, writer, publisher, TO_CHAR(regdate , 'YYYY-MM') as regdate, price, content, sellCount, page, bookSize
			FROM songpring_shop
			<choose>
				<when test="title != null">
					WHERE title LIKE '%'||#{title}||'%'
				</when>
				<when test="writer != null">
					WHERE writer=#{writer}
				</when>
				<when test="publisher != null">
					WHERE publisher=#{publisher}
				</when>
				<when test="genre != null">
					WHERE genre=#{genre}
				</when>
			</choose>
			<choose>
				<when test="order == 'highPrice'">
					ORDER BY price ASC
				</when>
				<when test="order == 'lowPrice'">
					ORDER BY price DESC
				</when>
				<when test="order == 'sellCount'">
					ORDER BY sellCount ASC
				</when>
				<when test="order == 'date'">
					ORDER BY regdate ASC
				</when>
				<otherwise>
					ORDER BY num ASC
				</otherwise>
			</choose>
			) result1)
	WHERE rnum BETWEEN #{startRowNum} AND #{endRowNum}
</select>
<select id="getCount" parameterType="shopDto" resultType="int">
	SELECT NVL(MAX(ROWNUM), 0)
	FROM songpring_shop
	<choose>
		<when test="title != null">
			WHERE title LIKE '%'||#{title}||'%'
		</when>
		<when test="writer != null">
			WHERE writer LIKE '%'||#{writer}||'%'
		</when>
		<when test="genre != null">
			WHERE genre LIKE '%'||#{genre}||'%'
		</when>
	</choose>
</select>
<update id="addSellCount" parameterType="int">
	UPDATE songpring_shop
	SET sellCount=sellCount+1
	WHERE num=#{num}
</update>
</mapper>